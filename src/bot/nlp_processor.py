try:
    import pymorphy3
except ImportError:
    # –î–ª—è —Ç–µ—Ö, –∫—Ç–æ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª pymorphy3
    pass
from typing import List, Tuple, Optional, Dict, Any
import re
import logging
from src.utils import format_teacher_disciplines

logger = logging.getLogger(__name__)

class NLPProcessor:
    """–ö–ª–∞—Å—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞ –∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
    
    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞"""
        self.morph = pymorphy3.MorphAnalyzer()
        
        # –°–ª–æ–≤–∞—Ä—å —Ñ–∞–º–∏–ª–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π
        self.teacher_surnames = {}
        
        # –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–∏–º–∏ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
        self.categories: Dict[str, set] = {
            'teacher': {'–ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å', '—É—á–∏—Ç–µ–ª—å', '–ø–µ–¥–∞–≥–æ–≥', '–ø—Ä–µ–ø–æ–¥–∞–µ—Ç', '–≤–µ–¥–µ—Ç', '–ø–∞—Ä–∞', '–ø–∞—Ä—ã', 
                       '—É—Ä–æ–∫', '—É—Ä–æ–∫–∏', '–∫—Ç–æ', '—Ç–∞–∫–∞—è', '—Ç–∞–∫–æ–π', '–∫–∞–∫–∏–µ', '–ø—Ä–µ–¥–º–µ—Ç—ã', '–ø–æ–∫–∞–∂–∏', '—Ä–∞—Å—Å–∫–∞–∂–∏', 
                       '–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', '—Å–ø–∏—Å–æ–∫', '–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è—Ö', '–æ —É—á–∏—Ç–µ–ª—è—Ö', '–ø–æ–∫–∞–∂–∏', '—É—á–∞—Ç', '–ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏',
                       '–Ω–∞–π—Ç–∏', '–∫–æ–Ω—Ç–∞–∫—Ç—ã', '–ø—Ä–µ–ø–æ–¥', '–≤–µ–¥—ë—Ç', '—É—á–∏—Ç', '—Ñ–∞–º–∏–ª–∏—è', '–ø—Ä–µ–ø–æ–¥–∞'},
            'discipline': {'–ø—Ä–µ–¥–º–µ—Ç', '–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞', '–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞', '–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ', '—ç–∫–æ–Ω–æ–º–∏–∫–∞',
                         '–±—É—Ö—É—á–µ—Ç', '–±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è', '—Ñ–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–∞–Ω–≥–ª–∏–π—Å–∫–∏–π', '–∏—Å—Ç–æ—Ä–∏—è', '—Ñ–∏–∑–∏–∫–∞', '–ø—Ä–∞–≤–æ',
                         '–ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '—Ä—É—Å—Å–∫–∏–π', '–∞–ª–≥–µ–±—Ä–∞', '–≥–µ–æ–º–µ—Ç—Ä–∏—è', '—Ö–∏–º–∏—è', '–±–∏–æ–ª–æ–≥–∏—è', '–∫—É—Ä—Å', 
                         '–ª–µ–∫—Ü–∏—è', '—Å–µ–º–∏–Ω–∞—Ä', '–ø—Ä–∞–∫—Ç–∏–∫–∞', '–ª–∞–±–∞', '–ø—Ä–µ–ø–æ–¥–∞–µ—Ç', '–≤–µ–¥–µ—Ç', '–∏–∑—É—á–∞–µ—Ç', '–∏–∑—É—á–∞–µ–º'},
            'document': {'—Å–ø—Ä–∞–≤–∫–∞', '–¥–æ–∫—É–º–µ–Ω—Ç', '–∑–∞—è–≤–ª–µ–Ω–∏–µ', '–ø–æ–ª—É—á–∏—Ç—å', '–æ—Ñ–æ—Ä–º–∏—Ç—å', '–±—É–º–∞–≥–∞', '—Å–ø—Ä–∞–≤–∫–∏', 
                        '–¥–æ–∫—É–º–µ–Ω—Ç—ã', '–±—É–º–∞–≥–∏', '–∑–∞–ø–æ–ª–Ω–∏—Ç—å', '–ø–æ–¥–∞—Ç—å', '—Å–ø—Ä–∞–≤–∫—É'},
            'navigation': {'–≥–¥–µ', '–Ω–∞–π—Ç–∏', '–Ω–∞—Ö–æ–¥–∏—Ç—Å—è', '—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ', '–∞—É–¥–∏—Ç–æ—Ä–∏—è', '–∫–∞–±–∏–Ω–µ—Ç', '—ç—Ç–∞–∂', '–∫–æ—Ä–ø—É—Å', 
                          '—Å—Ç–æ–ª–æ–≤–∞—è', '–±–∏–±–ª–∏–æ—Ç–µ–∫–∞', '–±—É—Ñ–µ—Ç', '—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∞', '–∞—É–¥–∏—Ç–æ—Ä–∏–∏', '–Ω–∞—Ö–æ–¥—è—Ç—Å—è', '–ø–æ–∏—Å–∫', 
                          '–∫–∞–∫ –ø—Ä–æ–π—Ç–∏', '–¥–æ—Ä–æ–≥–∞', '–ø—É—Ç—å', '–∞–∫—Ç–æ–≤—ã–π', '–∑–∞–ª', '–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è', '–º–µ–¥–ø—É–Ω–∫—Ç', '–¥–µ–∫–∞–Ω–∞—Ç'},
            'event': {'–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ', '—Å–æ–±—ã—Ç–∏–µ', '–ø—Ä–∞–∑–¥–Ω–∏–∫', '–∫–æ–Ω—Ü–µ—Ä—Ç', '–≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ', '–∫–æ–≥–¥–∞', '–∫–∞–∫–∏–µ', 
                     '—Ñ–µ—Å—Ç–∏–≤–∞–ª—å', '–≤—Å—Ç—Ä–µ—á–∞', '—Å–µ–º–∏–Ω–∞—Ä', '–∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è', '–∞–Ω–æ–Ω—Å', '—Å–∫–æ—Ä–æ', '–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è', '–∞—Ñ–∏—à–∞'},
            'sport': {'—Å–µ–∫—Ü–∏—è', '—Å–ø–æ—Ä—Ç', '—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞', '–∑–∞–Ω—è—Ç–∏–µ', '—Ç—Ä–µ–Ω–µ—Ä', '–∏–≥—Ä–∞', '–∫–∞–∫–∏–µ', '–µ—Å—Ç—å', 
                     '—Å–µ–∫—Ü–∏–∏', '–∑–∞–Ω—è—Ç–∏—è', '—Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ', '—Å–ø–æ—Ä—Ç–∑–∞–ª', '—Ñ–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '—Ñ—É—Ç–±–æ–ª', '–≤–æ–ª–µ–π–±–æ–ª', 
                     '–±–∞—Å–∫–µ—Ç–±–æ–ª', '—Ç–µ–Ω–Ω–∏—Å', '—Ç—Ä–µ–Ω–µ—Ä', '—Ñ–∏–∑—Ä—É–∫', '—Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π', '–∑–∞–Ω–∏–º–∞—Ç—å—Å—è'},
            'dormitory': {'–æ–±—â–µ–∂–∏—Ç–∏–µ', '–æ–±—â–∞–≥–∞', '–∫–æ–º–Ω–∞—Ç–∞', '–ø—Ä–æ–∂–∏–≤–∞–Ω–∏–µ', '–∑–∞—Å–µ–ª–µ–Ω–∏–µ', '–∫–æ–º–µ–Ω–¥–∞–Ω—Ç', '–∂–∏—Ç—å', 
                         '–ø–æ—Å–µ–ª–∏—Ç—å—Å—è', '–∫–≤–∞—Ä—Ç–∏—Ä–∞', '–æ–±—â–µ–∂–∏—Ç–∏—è', '–∑–∞—Å–µ–ª–∏—Ç—å—Å—è', '—É—Å–ª–æ–≤–∏—è', '–ø–ª–∞—Ç–∞', '—Å–Ω—è—Ç—å'}
        }
        
        # –°—Ç–æ–ø-—Å–ª–æ–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è –∏–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        self.stop_words = {'–∏', '–≤', '–≤–æ', '–Ω–µ', '—á—Ç–æ', '–æ–Ω', '–Ω–∞', '—è', '—Å', '—Å–æ', '–∫–∞–∫', '–∞', '—Ç–æ', '–≤—Å–µ', 
                          '–æ–Ω–∞', '—Ç–∞–∫', '–µ–≥–æ', '–Ω–æ', '–¥–∞', '—Ç—ã', '–∫', '—É', '–∂–µ', '–≤—ã', '–∑–∞', '–±—ã', '–ø–æ', 
                          '—Ç–æ–ª—å–∫–æ', '–µ–µ', '–º–Ω–µ', '–±—ã–ª–æ', '–≤–æ—Ç', '–æ—Ç', '–º–µ–Ω—è', '–µ—â–µ', '–Ω–µ—Ç', '–æ', '–∏–∑', 
                          '–µ–º—É', '—Ç–∞–∫–∞—è', '—ç—Ç–æ', '—ç—Ç–∞', '–≥–¥–µ', '–∫–∞–∫–∞—è'}

    def set_teacher_surnames(self, teachers_list):
        """–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å —Ñ–∞–º–∏–ª–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞"""
        try:
            self.teacher_surnames = {}
            
            if not teachers_list or len(teachers_list) == 0:
                logger.warning("Empty teachers list provided to set_teacher_surnames")
                return
                
            for teacher in teachers_list:
                if not isinstance(teacher, (list, tuple)):
                    logger.warning(f"Invalid teacher data type: {type(teacher)}")
                    continue
                    
                # –ü—Ä–æ–≤–µ—Ä–∏–º, –µ—Å—Ç—å –ª–∏ —É –Ω–∞—Å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è
                if len(teacher) < 4:
                    logger.warning(f"Teacher record has insufficient fields: {teacher}")
                    continue
                    
                # –°–æ–±–∏—Ä–∞–µ–º –§–ò–û –∏–∑ —Ñ–∞–º–∏–ª–∏–∏, –∏–º–µ–Ω–∏ –∏ –æ—Ç—á–µ—Å—Ç–≤–∞ (–∏–Ω–¥–µ–∫—Å—ã 1, 2, 3)
                try:
                    surname = str(teacher[1]).lower()  # –§–∞–º–∏–ª–∏—è –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ
                    full_name = f"{teacher[1]} {teacher[2]} {teacher[3]}"  # –§–ò–û
                    self.teacher_surnames[surname] = full_name
                    logger.debug(f"Added teacher surname: {surname} -> {full_name}")
                except Exception as e:
                    logger.error(f"Error processing teacher record {teacher}: {e}")
            
            logger.info(f"Teacher surnames dictionary initialized with {len(self.teacher_surnames)} entries")
        except Exception as e:
            logger.error(f"Error initializing teacher surnames: {e}")
            self.teacher_surnames = {}

    def normalize_word(self, word: str) -> str:
        """–ü—Ä–∏–≤–æ–¥–∏—Ç —Å–ª–æ–≤–æ –∫ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ñ–æ—Ä–º–µ"""
        try:
            return self.morph.parse(word)[0].normal_form
        except Exception as e:
            logger.error(f"Error normalizing word '{word}': {e}")
            return word

    def extract_keywords(self, text: str) -> List[str]:
        """–ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏–∑ —Ç–µ–∫—Å—Ç–∞"""
        try:
            # –£–±–∏—Ä–∞–µ–º –∑–Ω–∞–∫–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è –∏ –ø—Ä–∏–≤–æ–¥–∏–º –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
            text = re.sub(r'[^\w\s]', ' ', text.lower())

            # –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —Å–ª–æ–≤–∞ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∫–∞–∂–¥–æ–µ
            words = text.split()
            normalized_words = [self.normalize_word(word) for word in words]

            # –§–∏–ª—å—Ç—Ä—É–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞
            keywords = [word for word in normalized_words if word not in self.stop_words]
            logger.debug(f"Extracted keywords from '{text}': {keywords}")
            return keywords
        except Exception as e:
            logger.error(f"Error extracting keywords from '{text}': {e}")
            return []

    def find_discipline_in_text(self, text: str) -> Optional[str]:
        """–ò—â–µ—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –≤ —Ç–µ–∫—Å—Ç–µ"""
        try:
            # –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω
            if "–≤–µ–¥–µ—Ç" in text.lower() or "–ø—Ä–µ–ø–æ–¥–∞–µ—Ç" in text.lower() or "–≤–µ–¥—ë—Ç" in text.lower():
                for word in self.extract_keywords(text.lower()):
                    for discipline in self.categories.get('discipline', set()):
                        if discipline in word:
                            logger.info(f"Found discipline in query context: {discipline}")
                            return discipline.capitalize()
            
            # –ò—â–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤–∏–¥–∞ "–ú–î–ö XX.XX"
            mdk_pattern = re.compile(r'–º–¥–∫\s*\d{2}\.\d{2}', re.IGNORECASE)
            match = mdk_pattern.search(text)
            if match:
                # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –Ω–∞–π–¥–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ú–î–ö (—É–¥–∞–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã –∏ –ø—Ä–∏–≤–æ–¥–∏–º –∫ –≤–µ—Ä—Ö–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É)
                found_mdk = match.group().upper().replace(' ', '')
                logger.info(f"Found discipline in text: {found_mdk}")
                return found_mdk
                
            # –ò—â–µ–º –∏–º–µ–Ω–∞ –æ–±—â–∏—Ö –¥–∏—Å—Ü–∏–ø–ª–∏–Ω
            common_disciplines = ['–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞', '—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', 
                                '–∏—Å—Ç–æ—Ä–∏—è', '—Ñ–∏–∑–∏–∫–∞', '—Ö–∏–º–∏—è', '–±–∏–æ–ª–æ–≥–∏—è', '—ç–∫–æ–Ω–æ–º–∏–∫–∞', '–ø—Ä–∞–≤–æ',
                                '–±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è', '–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ', '–∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '—Ñ–∏–ª–æ—Å–æ—Ñ–∏—è',
                                '–ø—Å–∏—Ö–æ–ª–æ–≥–∏—è', '—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', '–∫—É–ª—å—Ç—É—Ä–∞', '–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç', '–º–∞—Ä–∫–µ—Ç–∏–Ω–≥',
                                '—Å–æ—Ü–∏–æ–ª–æ–≥–∏—è', '–ø–æ–ª–∏—Ç–æ–ª–æ–≥–∏—è', '—ç–∫–æ–ª–æ–≥–∏—è']
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª–Ω–æ–µ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã
            for discipline in common_disciplines:
                if discipline in text.lower():
                    logger.info(f"Found common discipline in text: {discipline}")
                    return discipline.capitalize()
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–∞—Å—Ç–∏—á–Ω–æ–µ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ (–µ—Å–ª–∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –∫–æ—Ä–æ—Ç–∫–∞—è)
            for discipline in common_disciplines:
                if len(discipline) > 5:
                    for word in self.extract_keywords(text.lower()):
                        if len(word) > 5 and (discipline in word or word in discipline):
                            logger.info(f"Found partial discipline match: {discipline} in/from {word}")
                            return discipline.capitalize()
                    
            return None
        except Exception as e:
            logger.error(f"Error finding discipline in text '{text}': {e}")
            return None

    def categorize_query(self, text: str) -> Tuple[str, List[str]]:
        """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∑–∞–ø—Ä–æ—Å–∞ –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞"""
        try:
            text_lower = text.lower()
            keywords = self.extract_keywords(text_lower)
            logger.info(f"Query text: {text_lower}")
            logger.info(f"Extracted keywords: {keywords}")
            
            # –î–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ find_discipline_in_text
            # –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ–º –ø–æ–∏—Å–∫ –ø–æ —à–∞–±–ª–æ–Ω–∞–º
            
            # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π
            teacher_patterns = [
                r"–∫—Ç–æ —Ç–∞–∫–∞—è ([\w]+)",
                r"–∫—Ç–æ —Ç–∞–∫–æ–π ([\w]+)",
                r"–ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å ([\w]+)",
                r"–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ ([\w]+)",
                r"–≥–¥–µ –Ω–∞–π—Ç–∏ ([\w]+)",
                r"–∫–æ–Ω—Ç–∞–∫—Ç—ã ([\w]+)"
            ]
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è—Ö
            for pattern in teacher_patterns:
                match = re.search(pattern, text_lower)
                if match:
                    teacher_name = match.group(1)
                    logger.info(f"Found teacher name pattern: {teacher_name} via pattern {pattern}")
                    # –î–æ–±–∞–≤–ª—è–µ–º –≤ keywords –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
                    keywords.append(teacher_name)
                    
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–º–∏–ª–∏–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è –≤ –∑–∞–ø—Ä–æ—Å–µ
            for word in keywords:
                for name_base, full_name in self.teacher_surnames.items():
                    if name_base in word.lower():
                        logger.info(f"Found teacher name: {full_name} from word {word}")
                        return 'teacher', [full_name]
                        
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —è–≤–Ω—ã—Ö —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ —Ñ–∞–º–∏–ª–∏—é
            text_lower = text.lower()
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —è–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            if ("–≥–¥–µ" in text_lower or "–∫–∞–∫ –Ω–∞–π—Ç–∏" in text_lower or "–∫–∞–∫ –ø—Ä–æ–π—Ç–∏" in text_lower or 
                "–º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ" in text_lower or "—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ" in text_lower):
                
                # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞
                if "–±–∏–±–ª–∏–æ—Ç–µ–∫" in text_lower:
                    logger.info("Direct mention of library location detected")
                    return 'navigation', ['–±–∏–±–ª–∏–æ—Ç–µ–∫–∞']
                    
                # –°—Ç–æ–ª–æ–≤–∞—è
                elif "—Å—Ç–æ–ª–æ–≤" in text_lower or "–±—É—Ñ–µ—Ç" in text_lower or "–ø–æ–µ—Å—Ç—å" in text_lower or "–µ–¥–∞" in text_lower:
                    logger.info("Direct mention of canteen location detected")
                    return 'navigation', ['—Å—Ç–æ–ª–æ–≤–∞—è']
                
                # VR-–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è
                elif "vr" in text_lower or "–ª–∞–±–æ—Ä–∞—Ç–æ—Ä" in text_lower:
                    logger.info("Direct mention of VR lab location detected")
                    return 'navigation', ['–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è']
                    
                # –î—Ä—É–≥–∏–µ –º–µ—Å—Ç–∞ (–æ–±—â–∏–π –∑–∞–ø—Ä–æ—Å –æ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏)
                else:
                    for loc in ["–¥–µ–∫–∞–Ω–∞—Ç", "—É—á–µ–±–Ω–∞—è —á–∞—Å—Ç—å", "—Å—Ç—É–¥—Å–æ–≤–µ—Ç", "–±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è", 
                               "–∞–∫—Ç–æ–≤—ã–π –∑–∞–ª", "—Å–ø–æ—Ä—Ç–∑–∞–ª", "–º–µ–¥–ø—É–Ω–∫—Ç"]:
                        if loc in text_lower:
                            logger.info(f"Direct mention of {loc} location detected")
                            return 'navigation', [loc]
                            
                    logger.info("General navigation query detected")
                    return 'navigation', keywords
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤ –∑–∞–ø—Ä–æ—Å–µ —è–≤–Ω—ã–µ —Å–ª–æ–≤–∞ –æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è—Ö
            if any(word in text_lower for word in ["–ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å", "—É—á–∏—Ç–µ–ª—å", "–ø–µ–¥–∞–≥–æ–≥"]):
                # –¢–µ–ø–µ—Ä—å –∏—â–µ–º –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –≤ –Ω–∞—à–µ–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ
                for word in keywords:
                    if len(word) > 3 and word.isalpha() and not any(
                        common_word in word.lower() for common_word in 
                        ["–≥–¥–µ", "–∫–∞–∫", "—á—Ç–æ", "–∫–æ–≥–¥–∞", "–ø–æ—á–µ–º—É", "–∫—Ç–æ", "–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è", "—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω"]
                    ):
                        logger.info(f"Potential teacher name found: {word}")
                        return 'teacher', [word]
            
            # –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –ø–æ—Ö–æ–∂ –Ω–∞ —Ñ–∞–º–∏–ª–∏—é (–∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç)
            for word in keywords:
                if (len(word) > 3 and word.isalpha() and word[0].isupper() and 
                    not any(common_word in word.lower() for common_word in 
                         ["–≥–¥–µ", "–∫–∞–∫", "—á—Ç–æ", "–∫–æ–≥–¥–∞", "–ø–æ—á–µ–º—É", "–∫—Ç–æ", "–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è", "—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω"])):
                    logger.info(f"Potential teacher surname found: {word}")
                    return 'teacher', [word]

            # –ò—â–µ–º –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É –≤ —Ç–µ–∫—Å—Ç–µ
            discipline = self.find_discipline_in_text(text_lower)
            if discipline:
                logger.info(f"Found discipline reference: {discipline}")
                return 'discipline', [discipline]

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —è–≤–Ω—ã—Ö —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            if "–ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏" in text_lower or "–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è—Ö" in text_lower or "—Å–ø–∏—Å–æ–∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π" in text_lower:
                logger.info("Direct mention of teachers list detected")
                return 'teacher', keywords
                
            if "—Å—Ç–æ–ª–æ–≤–∞—è" in text_lower or "–±—É—Ñ–µ—Ç" in text_lower or "–ø–æ–µ—Å—Ç—å" in text_lower:
                logger.info("Direct mention of canteen detected")
                return 'navigation', ['—Å—Ç–æ–ª–æ–≤–∞—è'] + keywords

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ (–ø–æ —Å–ª–æ–≤–∞–º)
            for category, category_keywords in self.categories.items():
                if any(keyword in category_keywords for keyword in keywords):
                    logger.info(f"Matched category by keyword: {category} with keywords: {keywords}")
                    return category, keywords
                    
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ (–ø–æ —á–∞—Å—Ç—è–º —Å–ª–æ–≤)
            for category, category_keywords in self.categories.items():
                for keyword in keywords:
                    for category_word in category_keywords:
                        if (len(keyword) > 3 and keyword in category_word) or (len(category_word) > 3 and category_word in keyword):
                            logger.info(f"Fuzzy matched category: {category} with keyword {keyword} matching {category_word}")
                            return category, keywords

            logger.info("No specific category matched")
            return 'unknown', keywords
        except Exception as e:
            logger.error(f"Error categorizing query '{text}': {e}")
            return 'unknown', []

    def process_query(self, text: str, db_manager) -> Optional[str]:
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç"""
        try:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–∞–Ω–¥—ã
            if text.startswith('/'):
                return None  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º None –¥–ª—è –∫–æ–º–∞–Ω–¥, —á—Ç–æ–±—ã –∏—Ö –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª CommandHandler

            category, keywords = self.categorize_query(text)
            logger.info(f"Query category: {category}, keywords: {keywords}")

            if not keywords:
                return "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –≤–æ–ø—Ä–æ—Å –ø–æ–¥—Ä–æ–±–Ω–µ–µ."

            if category == 'teacher':
                return self._process_teacher_query(db_manager, keywords)
            elif category == 'discipline':
                return self._process_discipline_query(db_manager, keywords)
            elif category == 'sport':
                return self._process_sport_query(db_manager)
            elif category == 'document':
                return self._process_document_query(db_manager)
            elif category == 'navigation':
                return self._process_navigation_query(db_manager, keywords)
            elif category == 'event':
                return self._process_event_query(db_manager)
            elif category == 'dormitory':
                return self._process_dormitory_query(db_manager)
            else:
                return "–ò–∑–≤–∏–Ω–∏—Ç–µ, —è –Ω–µ —Å–º–æ–≥ –ø–æ–Ω—è—Ç—å –≤–∞—à –≤–æ–ø—Ä–æ—Å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –∏–∑ –º–µ–Ω—é."
                
        except Exception as e:
            logger.error(f"Error processing query '{text}': {e}")
            return "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."

    def _process_teacher_query(self, db_manager, keywords: List[str]) -> str:
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ"""
        # –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π
        logger.info(f"Teacher query received via NLP (disabled): {keywords}")
        
        return ("üë®‚Äçüè´ <b>–ü–æ–∏—Å–∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</b>\n\n"
                "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å —Ñ—É–Ω–∫—Ü–∏–µ–π –ø–æ–∏—Å–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ –º–µ–Ω—é '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏' -> '–ü–æ–∏—Å–∫ –ø–æ —Ñ–∞–º–∏–ª–∏–∏'.\n\n"
                "–í —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã –∑–∞–ø—Ä–æ—Å—ã –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ (—Å—Ç–æ–ª–æ–≤–∞—è, –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏ —Ç.–¥.), "
                "–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö, –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö –∏ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö —Å–µ–∫—Ü–∏—è—Ö.")

    def _process_discipline_query(self, db_manager, keywords: List[str]) -> str:
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –æ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ"""
        # –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞–º
        logger.info(f"Discipline query received via NLP (disabled): {keywords}")
        
        return ("üìö <b>–ü–æ–∏—Å–∫ –ø–æ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞–º —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</b>\n\n"
                "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –º–µ–Ω—é –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è—Ö –∏ –∏—Ö –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞—Ö.\n\n"
                "–í —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã –∑–∞–ø—Ä–æ—Å—ã –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ (—Å—Ç–æ–ª–æ–≤–∞—è, –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏ —Ç.–¥.), "
                "–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö, –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö –∏ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö —Å–µ–∫—Ü–∏—è—Ö.")

    def _process_sport_query(self, db_manager) -> str:
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –æ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö —Å–µ–∫—Ü–∏—è—Ö"""
        sections = db_manager.get_sections()
        if not sections:
            return "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö —Å–µ–∫—Ü–∏—è—Ö –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –†–µ–∫–æ–º–µ–Ω–¥—É—é –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –Ω–∞ –∫–∞—Ñ–µ–¥—Ä—É —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∫—É–ª—å—Ç—É—Ä—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏."
            
        response = "üèÜ <b>–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ –≤ –∫–æ–ª–ª–µ–¥–∂–µ</b>\n\n"
        response += "–í –Ω–∞—à–µ–º –∫–æ–ª–ª–µ–¥–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤. –í—ã –º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å –ª—é–±—É—é —Å–µ–∫—Ü–∏—é –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –≤–∞—à–∏–º–∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º–∏:\n\n"
        
        for section in sections:
            name = section[1] if len(section) > 1 else "–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ"
            coach = section[2] if len(section) > 2 else "–ù–µ —É–∫–∞–∑–∞–Ω"
            location = section[3] if len(section) > 3 else "–ù–µ —É–∫–∞–∑–∞–Ω–æ"
            schedule = section[4] if len(section) > 4 else "–ù–µ —É–∫–∞–∑–∞–Ω–æ"
            
            response += f"üéØ <b>{name}</b>\n"
            response += f"üë®‚Äçüè´ –¢—Ä–µ–Ω–µ—Ä: {coach}\n"
            response += f"üìç –ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è: {location}\n"
            response += f"‚è∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: {schedule}\n\n"
        
        response += "–î–ª—è –∑–∞–ø–∏—Å–∏ –≤ —Å–µ–∫—Ü–∏—é –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ç—Ä–µ–Ω–µ—Ä—É –∏–ª–∏ –Ω–∞ –∫–∞—Ñ–µ–¥—Ä—É —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∫—É–ª—å—Ç—É—Ä—ã. –ó–∞–Ω—è—Ç–∏—è –≤ —Å–µ–∫—Ü–∏—è—Ö –ø–æ–º–æ–≥—É—Ç –≤–∞–º –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫—É—é —Ñ–æ—Ä–º—É –∏ —É—Å–ø–µ—à–Ω–æ —Å–¥–∞–≤–∞—Ç—å –Ω–æ—Ä–º–∞—Ç–∏–≤—ã."
        
        return response

    def _process_document_query(self, db_manager) -> str:
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö"""
        docs = db_manager.get_documents()
        if not docs:
            return "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –†–µ–∫–æ–º–µ–Ω–¥—É—é –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ —É—á–µ–±–Ω—É—é —á–∞—Å—Ç—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö."
            
        response = "üìÑ <b>–î–æ–∫—É–º–µ–Ω—Ç—ã –∏ —Å–ø—Ä–∞–≤–∫–∏ –≤ –∫–æ–ª–ª–µ–¥–∂–µ</b>\n\n"
        response += "–í –Ω–∞—à–µ–º –∫–æ–ª–ª–µ–¥–∂–µ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ —Å–ø—Ä–∞–≤–∫–∏. –ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–º, –∫–∞–∫ –∏—Ö –ø–æ–ª—É—á–∏—Ç—å:\n\n"
        
        for doc in docs:
            name = doc[1] if len(doc) > 1 else "–ù–µ —É–∫–∞–∑–∞–Ω–æ"
            description = doc[2] if len(doc) > 2 else "–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç"
            link = doc[3] if len(doc) > 3 and doc[3] else None
            
            response += f"üìë <b>{name}</b>\n"
            response += f"‚ÑπÔ∏è {description}\n"
            if link:
                response += f"üîó <a href='{link}'>–°–∫–∞—á–∞—Ç—å –±–ª–∞–Ω–∫/–æ–±—Ä–∞–∑–µ—Ü</a>\n"
            response += "\n"
            
        response += "<b>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã:</b>\n"
        response += "‚Ä¢ –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø—Ä–∞–≤–æ–∫ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –≤ —É—á–µ–±–Ω—É—é —á–∞—Å—Ç—å (–∫–∞–±–∏–Ω–µ—Ç 205) –≤ —á–∞—Å—ã —Ä–∞–±–æ—Ç—ã: –ø–Ω-–ø—Ç 9:00-17:00\n"
        response += "‚Ä¢ –°–ø—Ä–∞–≤–∫–∏ –æ–± –æ–±—É—á–µ–Ω–∏–∏ –≤—ã–¥–∞—é—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π –ø–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–∞\n"
        response += "‚Ä¢ –ü—Ä–∏ —Å–µ–±–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–º–µ—Ç—å —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π –±–∏–ª–µ—Ç –∏–ª–∏ –ø–∞—Å–ø–æ—Ä—Ç\n"
        response += "‚Ä¢ –ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –º–æ–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Å–≤–æ–µ–º—É –∫—É—Ä–∞—Ç–æ—Ä—É –≥—Ä—É–ø–ø—ã\n"
        
        return response

    def _process_navigation_query(self, db_manager, keywords: List[str]) -> str:
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –æ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –∫–æ–ª–ª–µ–¥–∂—É"""
        # –ü–æ–ª—É—á–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        places = db_manager.get_navigation()
        if not places or len(places) == 0:
            return "üè¢ <b>–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–æ–ª–ª–µ–¥–∂—É</b>\n\n–ò–∑–≤–∏–Ω–∏—Ç–µ, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –ø–æ–º–µ—â–µ–Ω–∏–π –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –Ω–∞ —Ä–µ—Å–µ–ø—à–Ω –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ –∑–¥–∞–Ω–∏–µ –∫–æ–ª–ª–µ–¥–∂–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏."
            
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –±—ã–ª –ª–∏ –∑–∞–ø—Ä–æ—Å –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –º–µ—Å—Ç–µ
        keywords_string = " ".join(keywords).lower()
        
        # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞
        if "–±–∏–±–ª–∏–æ—Ç–µ–∫–∞" in keywords_string or "–±–∏–±–ª–∏–æ—Ç–µ–∫–∏" in keywords_string or "–∫–Ω–∏–≥–∏" in keywords_string:
            return ("üìö <b>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∫–æ–ª–ª–µ–¥–∂–∞</b>\n\n"
                   "–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ 3 —ç—Ç–∞–∂–µ –≤ –∫–∞–±–∏–Ω–µ—Ç–µ 312. \n\n"
                   "<b>–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã:</b> –ü–Ω-–ü—Ç —Å 9:00 –¥–æ 17:00, –æ–±–µ–¥ —Å 12:00 –¥–æ 13:00\n\n"
                   "<b>–£—Å–ª—É–≥–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:</b>\n"
                   "‚Ä¢ –í—ã–¥–∞—á–∞ —É—á–µ–±–Ω–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã\n"
                   "‚Ä¢ –î–æ—Å—Ç—É–ø –∫ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º\n"
                   "‚Ä¢ –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–æ–º–æ—â—å\n"
                   "‚Ä¢ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤\n\n"
                   "–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É—á–µ–±–Ω–∏–∫–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥—ä—è–≤–∏—Ç—å —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π –±–∏–ª–µ—Ç. "
                   "–°—Ä–æ–∫ –≤—ã–¥–∞—á–∏ —É—á–µ–±–Ω–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã - –æ–¥–∏–Ω —Å–µ–º–µ—Å—Ç—Ä.")
            
        # VR-–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è
        elif "vr" in keywords_string or "–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è" in keywords_string or "–≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å" in keywords_string:
            return ("üéÆ <b>VR-–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è</b>\n\n"
                   "VR-–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∞ –Ω–∞ 2 —ç—Ç–∞–∂–µ –≤ –∫–∞–±–∏–Ω–µ—Ç–µ 208. \n\n"
                   "<b>–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã:</b> –ü–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –∑–∞–Ω—è—Ç–∏–π –∏ –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π\n\n"
                   "<b>–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ:</b>\n"
                   "‚Ä¢ VR-—à–ª–µ–º—ã Oculus Quest 2\n"
                   "‚Ä¢ –ú–æ—â–Ω—ã–µ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å VR\n"
                   "‚Ä¢ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –¥–∏—Å–ø–ª–µ–∏\n\n"
                   "–î–ª—è –ø–æ—Å–µ—â–µ–Ω–∏—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏ –≤–Ω–µ —É—á–µ–±–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è —É –∫—É—Ä–∞—Ç–æ—Ä–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏.")
            
        # –£—á–µ–±–Ω–∞—è —á–∞—Å—Ç—å / –¥–µ–∫–∞–Ω–∞—Ç
        elif "—É—á–µ–±–Ω–∞—è" in keywords_string or "–¥–µ–∫–∞–Ω–∞—Ç" in keywords_string or "—É—á–µ–±–Ω—ã–π" in keywords_string:
            return ("üìù <b>–£—á–µ–±–Ω–∞—è —á–∞—Å—Ç—å –∫–æ–ª–ª–µ–¥–∂–∞</b>\n\n"
                   "–£—á–µ–±–Ω–∞—è —á–∞—Å—Ç—å —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∞ –Ω–∞ 2 —ç—Ç–∞–∂–µ –≤ –∫–∞–±–∏–Ω–µ—Ç–µ 205. \n\n"
                   "<b>–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã:</b> –ü–Ω-–ü—Ç —Å 9:00 –¥–æ 17:00, –æ–±–µ–¥ —Å 12:00 –¥–æ 13:00\n\n"
                   "<b>–í–æ–ø—Ä–æ—Å—ã, —Ä–µ—à–∞–µ–º—ã–µ –≤ —É—á–µ–±–Ω–æ–π —á–∞—Å—Ç–∏:</b>\n"
                   "‚Ä¢ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏–π\n"
                   "‚Ä¢ –í—ã–¥–∞—á–∞ —Å–ø—Ä–∞–≤–æ–∫ –æ–± –æ–±—É—á–µ–Ω–∏–∏\n"
                   "‚Ä¢ –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏—Ö –æ—Ç–ø—É—Å–∫–æ–≤\n"
                   "‚Ä¢ –í—ã–¥–∞—á–∞ –∑–∞—á–µ—Ç–Ω—ã—Ö –∫–Ω–∏–∂–µ–∫ –∏ —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏—Ö –±–∏–ª–µ—Ç–æ–≤\n"
                   "‚Ä¢ –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞\n\n"
                   "–ü—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–º–µ—Ç—å –ø—Ä–∏ —Å–µ–±–µ —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π –±–∏–ª–µ—Ç –∏–ª–∏ –∑–∞—á–µ—Ç–Ω—É—é –∫–Ω–∏–∂–∫—É.")
            
        # –°—Ç–æ–ª–æ–≤–∞—è / –±—É—Ñ–µ—Ç
        elif "—Å—Ç–æ–ª–æ–≤–∞—è" in keywords_string or "–±—É—Ñ–µ—Ç" in keywords_string or "–ø–æ–µ—Å—Ç—å" in keywords_string or "–µ–¥–∞" in keywords_string:
            return ("üçΩÔ∏è <b>–°—Ç–æ–ª–æ–≤–∞—è –∏ –±—É—Ñ–µ—Ç –∫–æ–ª–ª–µ–¥–∂–∞</b>\n\n"
                   "–°—Ç–æ–ª–æ–≤–∞—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ 1 —ç—Ç–∞–∂–µ. \n\n"
                   "<b>–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã:</b>\n"
                   "‚Ä¢ –°—Ç–æ–ª–æ–≤–∞—è: –ü–Ω-–ü—Ç —Å 9:00 –¥–æ 16:00\n"
                   "‚Ä¢ –ë—É—Ñ–µ—Ç: –ü–Ω-–ü—Ç —Å 8:30 –¥–æ 17:00\n\n"
                   "<b>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∏—Ç–∞–Ω–∏–∏:</b>\n"
                   "‚Ä¢ –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–µ –º–µ–Ω—é\n"
                   "‚Ä¢ –í–æ–∑–º–æ–∂–Ω–∞ –æ–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏ –∏ –±–∞–Ω–∫–æ–≤—Å–∫–∏–º–∏ –∫–∞—Ä—Ç–∞–º–∏\n"
                   "‚Ä¢ –î–ª—è –ª—å–≥–æ—Ç–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ\n\n"
                   "–î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –ª—å–≥–æ—Ç–Ω–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–π –æ—Ç–¥–µ–ª –∫–æ–ª–ª–µ–¥–∂–∞.")
            
        # –°—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π —Å–æ–≤–µ—Ç
        elif "—Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π" in keywords_string or "—Å–æ–≤–µ—Ç" in keywords_string or "—Å—Ç—É–¥—Å–æ–≤–µ—Ç" in keywords_string:
            return ("üë• <b>–°—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π —Å–æ–≤–µ—Ç –∫–æ–ª–ª–µ–¥–∂–∞</b>\n\n"
                   "–°—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π —Å–æ–≤–µ—Ç —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –Ω–∞ 2 —ç—Ç–∞–∂–µ –≤ –∫–∞–±–∏–Ω–µ—Ç–µ 220. \n\n"
                   "<b>–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã:</b> –ü–Ω-–ü—Ç —Å 10:00 –¥–æ 16:00\n\n"
                   "<b>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å—Ç—É–¥—Å–æ–≤–µ—Ç–∞:</b>\n"
                   "‚Ä¢ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π\n"
                   "‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏—Ö –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤\n"
                   "‚Ä¢ –ó–∞—â–∏—Ç–∞ –ø—Ä–∞–≤ –∏ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤\n"
                   "‚Ä¢ –í–æ–ª–æ–Ω—Ç–µ—Ä—Å—Ç–≤–æ –∏ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å\n\n"
                   "–ö–∞–∂–¥—ã–π —Å—Ç—É–¥–µ–Ω—Ç –º–æ–∂–µ—Ç –ø—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ –≤ —Ä–∞–±–æ—Ç–µ —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–æ–≥–æ —Å–æ–≤–µ—Ç–∞. –í—ã–±–æ—Ä—ã –≤ —Å—Ç—É–¥—Å–æ–≤–µ—Ç –ø—Ä–æ–≤–æ–¥—è—Ç—Å—è –µ–∂–µ–≥–æ–¥–Ω–æ –≤ –æ–∫—Ç—è–±—Ä–µ.")
            
        # –ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è
        elif "–±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è" in keywords_string or "–æ–ø–ª–∞—Ç–∞" in keywords_string or "—Ñ–∏–Ω–∞–Ω—Å—ã" in keywords_string:
            return ("üí∞ <b>–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è –∫–æ–ª–ª–µ–¥–∂–∞</b>\n\n"
                   "–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ 1 —ç—Ç–∞–∂–µ –≤ –∫–∞–±–∏–Ω–µ—Ç–µ 103. \n\n"
                   "<b>–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã:</b> –ü–Ω-–ü—Ç —Å 9:00 –¥–æ 16:00, –æ–±–µ–¥ —Å 12:00 –¥–æ 13:00\n"
                   "<b>–ü—Ä–∏–µ–º–Ω—ã–µ —á–∞—Å—ã –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤:</b> –í—Ç, –ß—Ç —Å 13:00 –¥–æ 16:00\n\n"
                   "<b>–í–æ–ø—Ä–æ—Å—ã, —Ä–µ—à–∞–µ–º—ã–µ –≤ –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–∏:</b>\n"
                   "‚Ä¢ –û–ø–ª–∞—Ç–∞ –æ–±—É—á–µ–Ω–∏—è\n"
                   "‚Ä¢ –í—ã–¥–∞—á–∞ –∫–≤–∏—Ç–∞–Ω—Ü–∏–π –∏ —Å–ø—Ä–∞–≤–æ–∫ –æ–± –æ–ø–ª–∞—Ç–µ\n"
                   "‚Ä¢ –°—Ç–∏–ø–µ–Ω–¥–∏–∞–ª—å–Ω—ã–µ –≤—ã–ø–ª–∞—Ç—ã\n"
                   "‚Ä¢ –ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–∞—è –ø–æ–º–æ—â—å\n\n"
                   "–î–ª—è —Ä–µ—à–µ–Ω–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–º–µ—Ç—å –ø—Ä–∏ —Å–µ–±–µ –ø–∞—Å–ø–æ—Ä—Ç –∏ —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π –±–∏–ª–µ—Ç.")
            
        # –ê–∫—Ç–æ–≤—ã–π –∑–∞–ª
        elif "–∞–∫—Ç–æ–≤—ã–π" in keywords_string or "–∑–∞–ª" in keywords_string:
            return ("üé≠ <b>–ê–∫—Ç–æ–≤—ã–π –∑–∞–ª –∫–æ–ª–ª–µ–¥–∂–∞</b>\n\n"
                   "–ê–∫—Ç–æ–≤—ã–π –∑–∞–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ 2 —ç—Ç–∞–∂–µ. \n\n"
                   "<b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n"
                   "‚Ä¢ –í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: –¥–æ 200 —á–µ–ª–æ–≤–µ–∫\n"
                   "‚Ä¢ –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ: —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞—É–¥–∏–æ –∏ –≤–∏–¥–µ–æ—Å–∏—Å—Ç–µ–º—ã, –ø—Ä–æ–µ–∫—Ç–æ—Ä\n"
                   "‚Ä¢ –°—Ü–µ–Ω–∞ –ø–ª–æ—â–∞–¥—å—é 40 –∫–≤.–º\n\n"
                   "<b>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:</b>\n"
                   "‚Ä¢ –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ —Ç–æ—Ä–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π\n"
                   "‚Ä¢ –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏ –∏ —Å–µ–º–∏–Ω–∞—Ä—ã\n"
                   "‚Ä¢ –ö–æ–Ω—Ü–µ—Ä—Ç—ã –∏ —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è\n"
                   "‚Ä¢ –°–æ–±—Ä–∞–Ω–∏—è –∏ –≤—Å—Ç—Ä–µ—á–∏\n\n"
                   "–î–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–æ–≤–æ–≥–æ –∑–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –∑–∞–º–µ—Å—Ç–∏—Ç–µ–ª—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ –ø–æ –≤–æ—Å–ø–∏—Ç–∞—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ.")
            
        # –°–ø–æ—Ä—Ç–∑–∞–ª
        elif "—Å–ø–æ—Ä—Ç–∑–∞–ª" in keywords_string or "—Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π" in keywords_string or "—Ñ–∏–∑–∫—É–ª—å—Ç—É—Ä–∞" in keywords_string:
            return ("üèÄ <b>–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∑–∞–ª –∫–æ–ª–ª–µ–¥–∂–∞</b>\n\n"
                   "–°–ø–æ—Ä—Ç–∑–∞–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ 2 —ç—Ç–∞–∂–µ. \n\n"
                   "<b>–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã:</b> –ü–Ω-–°–± —Å 8:00 –¥–æ 20:00 –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –∑–∞–Ω—è—Ç–∏–π –∏ —Å–µ–∫—Ü–∏–π\n\n"
                   "<b>–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:</b>\n"
                   "‚Ä¢ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏–≥—Ä–æ–≤–æ–π –∑–∞–ª\n"
                   "‚Ä¢ –¢—Ä–µ–Ω–∞–∂–µ—Ä–Ω—ã–π –∑–∞–ª\n"
                   "‚Ä¢ –†–∞–∑–¥–µ–≤–∞–ª–∫–∏ —Å –¥—É—à–µ–≤—ã–º–∏\n"
                   "‚Ä¢ –°–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å\n\n"
                   "<b>–°–µ–∫—Ü–∏–∏ –∏ –∑–∞–Ω—è—Ç–∏—è:</b>\n"
                   "‚Ä¢ –í–æ–ª–µ–π–±–æ–ª, –±–∞—Å–∫–µ—Ç–±–æ–ª, –º–∏–Ω–∏-—Ñ—É—Ç–±–æ–ª\n"
                   "‚Ä¢ –ù–∞—Å—Ç–æ–ª—å–Ω—ã–π —Ç–µ–Ω–Ω–∏—Å\n"
                   "‚Ä¢ –§–∏—Ç–Ω–µ—Å –∏ –æ–±—â–∞—è —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞\n\n"
                   "–î–ª—è –ø–æ—Å–µ—â–µ–Ω–∏—è —Å–ø–æ—Ä—Ç–∑–∞–ª–∞ –≤–Ω–µ —É—á–µ–±–Ω—ã—Ö –∑–∞–Ω—è—Ç–∏–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è —É –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è —Ñ–∏–∑–∫—É–ª—å—Ç—É—Ä—ã.")
            
        # –ú–µ–¥–ø—É–Ω–∫—Ç
        elif "–º–µ–¥–ø—É–Ω–∫—Ç" in keywords_string or "–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π" in keywords_string or "–≤—Ä–∞—á" in keywords_string:
            return ("ü©∫ <b>–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –ø—É–Ω–∫—Ç –∫–æ–ª–ª–µ–¥–∂–∞</b>\n\n"
                   "–ú–µ–¥–ø—É–Ω–∫—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ 1 —ç—Ç–∞–∂–µ –≤ –∫–∞–±–∏–Ω–µ—Ç–µ 106. \n\n"
                   "<b>–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã:</b> –ü–Ω-–ü—Ç —Å 9:00 –¥–æ 16:00\n\n"
                   "<b>–£—Å–ª—É–≥–∏ –º–µ–¥–ø—É–Ω–∫—Ç–∞:</b>\n"
                   "‚Ä¢ –ü–µ—Ä–≤–∞—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –ø–æ–º–æ—â—å\n"
                   "‚Ä¢ –ü–ª–∞–Ω–æ–≤—ã–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –æ—Å–º–æ—Ç—Ä—ã\n"
                   "‚Ä¢ –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è\n"
                   "‚Ä¢ –í—ã–¥–∞—á–∞ —Å–ø—Ä–∞–≤–æ–∫ –ø–æ –±–æ–ª–µ–∑–Ω–∏\n\n"
                   "–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –ø–æ–º–æ—â–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥—ä—è–≤–∏—Ç—å —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π –±–∏–ª–µ—Ç –∏ –ø–æ–ª–∏—Å –û–ú–°. "
                   "–í —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö –ø–æ–º–æ—â—å –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤—Å–µ–º –æ–±—Ä–∞—Ç–∏–≤—à–∏–º—Å—è.")
            
        # –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        else:
            response = "üè¢ <b>–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–æ–ª–ª–µ–¥–∂—É</b>\n\n"
            response += "–ó–¥–∞–Ω–∏–µ –∫–æ–ª–ª–µ–¥–∂–∞ –∏–º–µ–µ—Ç 3 —ç—Ç–∞–∂–∞. –ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–º–µ—â–µ–Ω–∏–π:\n\n"
            
            response += "üìö <b>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞</b>: 3 —ç—Ç–∞–∂, –∫–∞–±–∏–Ω–µ—Ç 312\n"
            response += "üéÆ <b>VR-–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è</b>: 2 —ç—Ç–∞–∂, –∫–∞–±–∏–Ω–µ—Ç 208\n"
            response += "üìù <b>–£—á–µ–±–Ω–∞—è —á–∞—Å—Ç—å</b>: 2 —ç—Ç–∞–∂, –∫–∞–±–∏–Ω–µ—Ç 205\n"
            response += "üçΩÔ∏è <b>–°—Ç–æ–ª–æ–≤–∞—è</b>: 1 —ç—Ç–∞–∂\n"
            response += "üë• <b>–°—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π —Å–æ–≤–µ—Ç</b>: 2 —ç—Ç–∞–∂, –∫–∞–±–∏–Ω–µ—Ç 220\n"
            response += "üí∞ <b>–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è</b>: 1 —ç—Ç–∞–∂, –∫–∞–±–∏–Ω–µ—Ç 103\n"
            response += "üé≠ <b>–ê–∫—Ç–æ–≤—ã–π –∑–∞–ª</b>: 2 —ç—Ç–∞–∂\n"
            response += "üèÄ <b>–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∑–∞–ª</b>: 2 —ç—Ç–∞–∂\n"
            response += "ü©∫ <b>–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –ø—É–Ω–∫—Ç</b>: 1 —ç—Ç–∞–∂, –∫–∞–±–∏–Ω–µ—Ç 106\n\n"
            
            response += "–î–ª—è –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –ø–æ–º–µ—â–µ–Ω–∏–∏, —Å–ø—Ä–æ—Å–∏—Ç–µ –Ω–∞–ø—Ä–∏–º–µ—Ä: '–ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞?' –∏–ª–∏ '–ö–∞–∫ –ø—Ä–æ–π—Ç–∏ –≤ —Å—Ç–æ–ª–æ–≤—É—é?'"
            
            return response
            
    def _process_event_query(self, db_manager) -> str:
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö"""
        events = db_manager.get_events()
        if not events:
            return "üéâ <b>–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∫–æ–ª–ª–µ–¥–∂–∞</b>\n\n–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—É–¥—É—â–∏—Ö —Å–æ–±—ã—Ç–∏—è—Ö –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ–∑–∂–µ. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –≤ –≥—Ä—É–ø–ø–µ –∫–æ–ª–ª–µ–¥–∂–∞ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ –∏ Telegram-–∫–∞–Ω–∞–ª–µ."
            
        response = "üéâ <b>–ë–ª–∏–∂–∞–π—à–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∫–æ–ª–ª–µ–¥–∂–∞</b>\n\n"
        response += "–í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –≤ –∫–æ–ª–ª–µ–¥–∂–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è. –ü—Ä–∏–≥–ª–∞—à–∞–µ–º –≤—Å–µ—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ!\n\n"
        
        for event in events:
            date = event[1] if len(event) > 1 else "–î–∞—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞"
            title = event[2] if len(event) > 2 else "–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ"
            location = event[3] if len(event) > 3 else "–ú–µ—Å—Ç–æ –Ω–µ —É–∫–∞–∑–∞–Ω–æ"
            
            response += f"üìå <b>{title}</b>\n"
            response += f"üìÖ –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è: {date}\n"
            response += f"üìç –ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è: {location}\n\n"
        
        response += "<b>–ö–∞–∫ –ø—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ:</b>\n"
        response += "‚Ä¢ –î–ª—è —É—á–∞—Å—Ç–∏—è –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è\n"
        response += "‚Ä¢ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –º–æ–∂–Ω–æ —É –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤ –∏–ª–∏ —á–µ—Ä–µ–∑ —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π —Å–æ–≤–µ—Ç\n"
        response += "‚Ä¢ –°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –≤ –≥—Ä—É–ø–ø–µ –∫–æ–ª–ª–µ–¥–∂–∞ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ –∏ Telegram-–∫–∞–Ω–∞–ª–µ\n"
        
        return response

    def _process_dormitory_query(self, db_manager) -> str:
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –æ–± –æ–±—â–µ–∂–∏—Ç–∏—è—Ö"""
        dorms = db_manager.get_dormitories()
        if not dorms:
            return "üè† <b>–û–±—â–µ–∂–∏—Ç–∏—è –∫–æ–ª–ª–µ–¥–∂–∞</b>\n\n–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—â–µ–∂–∏—Ç–∏—è—Ö –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ —É—á–µ–±–Ω—É—é —á–∞—Å—Ç—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞—Å–µ–ª–µ–Ω–∏–∏ –∏ —É—Å–ª–æ–≤–∏—è—Ö –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è."
            
        response = "üè† <b>–û–±—â–µ–∂–∏—Ç–∏—è –ü–µ—Ä–º—Å–∫–æ–≥–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ-—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–ª–ª–µ–¥–∂–∞</b>\n\n"
        response += "–°—Ç—É–¥–µ–Ω—Ç–∞–º –∫–æ–ª–ª–µ–¥–∂–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è –≤ –æ–±—â–µ–∂–∏—Ç–∏—è—Ö. –ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—â–µ–∂–∏—Ç–∏—è—Ö, —É—Å–ª–æ–≤–∏—è—Ö –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è –∏ –ø—Ä–∞–≤–∏–ª–∞—Ö –∑–∞—Å–µ–ª–µ–Ω–∏—è:\n\n"
        
        for dorm in dorms:
            number = dorm[1] if len(dorm) > 1 else "–ù–æ–º–µ—Ä –Ω–µ —É–∫–∞–∑–∞–Ω"
            warden = dorm[2] if len(dorm) > 2 else "–ù–µ —É–∫–∞–∑–∞–Ω"
            address = dorm[3] if len(dorm) > 3 else "–ù–µ —É–∫–∞–∑–∞–Ω"
            phone = dorm[4] if len(dorm) > 4 else "–ù–µ —É–∫–∞–∑–∞–Ω"
            
            response += f"üè¢ <b>–û–±—â–µ–∂–∏—Ç–∏–µ ‚Ññ{number}</b>\n"
            response += f"üìç –ê–¥—Ä–µ—Å: {address}\n"
            response += f"üë§ –ö–æ–º–µ–Ω–¥–∞–Ω—Ç: {warden}\n"
            response += f"üìû –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω: {phone}\n\n"
        
        response += "<b>–ü—Ä–∞–≤–∏–ª–∞ –∑–∞—Å–µ–ª–µ–Ω–∏—è –≤ –æ–±—â–µ–∂–∏—Ç–∏–µ:</b>\n"
        response += "‚Ä¢ –ó–∞—Å–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –ø—Ä–∏–∫–∞–∑–∞ –æ –∑–∞—á–∏—Å–ª–µ–Ω–∏–∏\n"
        response += "‚Ä¢ –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–∞—Å–ø–æ—Ä—Ç, –º–µ–¥–∏—Ü–∏–Ω—Å–∫—É—é —Å–ø—Ä–∞–≤–∫—É –∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏\n"
        response += "‚Ä¢ –ó–∞—Å–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ –∞–≤–≥—É—Å—Ç–∞ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —É—á–µ–±–Ω–æ–≥–æ –≥–æ–¥–∞\n"
        response += "‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è –∏ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å –≤ —É—á–µ–±–Ω–æ–π —á–∞—Å—Ç–∏\n\n"
        
        response += "–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –≤ —É—á–µ–±–Ω—É—é —á–∞—Å—Ç—å –∫–æ–ª–ª–µ–¥–∂–∞."
        
        return response
